<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <title>Cuppy-Home</title>
    <style>
        body {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 0.5s ease-in-out; /* åˆ‡æ›åœ–ç‰‡æ™‚çš„éæ¸¡æ•ˆæœ */
        }
    </style>
</head>
<body class="home">
    <script src="./assets/js/script.js"></script>
    <div class="dialog-box">
        <h2 id="greeting">Hi [name]!</h2>
        <p></p>
    </div>
        <div class="btn-group" role="group">
            <a href="home.html" class="btn btn-primary active">
            <i class="bi bi-house"></i>
            </a>
            <a href="journey.html" class="btn btn-primary">
            <i class="bi bi-map"></i>
            </a>
            <a href="journal.html" class="btn btn-primary">
            <i class="bi bi-journal"></i>
            </a>
            <a href="add.html" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i>
            </a>
        </div>
    </div>
    <script>
        const cupId = localStorage.getItem('cupId') || "1"; // å¾ localStorage ä¸­è®€å– cupIdï¼Œé è¨­ç‚º 1
        // å®šç¾©åœ–ç‰‡æ¸…å–®
        const images = [
            `./assets/images/${cupId}/hide.webp`,
            `./assets/images/${cupId}/open.webp`,
            `./assets/images/${cupId}/hand.webp`,
            `./assets/images/${cupId}/full.webp`
        ];

        let currentIndex = 0;

        // å®šç¾©å‡½æ•¸ï¼šä¾æ¬¡æ’­æ”¾åœ–ç‰‡
        function playBackgroundAnimation() {
            if (currentIndex < images.length) {
                document.body.style.backgroundImage = `url('${images[currentIndex]}')`;
                currentIndex++;
                setTimeout(playBackgroundAnimation, 400); // æ¯ 2 ç§’åˆ‡æ›ä¸€æ¬¡åœ–ç‰‡
            }
        }

        // é€²å…¥é é¢æ™‚åŸ·è¡Œå‹•ç•«
        document.addEventListener("DOMContentLoaded", playBackgroundAnimation);
    </script>
    <script>
        const apiUrl = 'https://script.google.com/macros/s/AKfycbyD_LXpUnn6BSWGIMiyvWtXJW11QfsYyn6xCgwY5L-cmn6jSO4z3oJBXt0Z6Rk3tgND/exec';  // å°‡ Apps Script API URL å„²å­˜æˆä¸€å€‹è®Šæ•¸
        // å¾ localStorage ä¸­å–å‡º username
        const username = localStorage.getItem('username');
        const cuppyName = localStorage.getItem('cuppyName');
        // å¦‚æœ username å­˜åœ¨ï¼Œå°‡å…¶é¡¯ç¤ºåœ¨ greeting å…ƒç´ ä¸­
        if (username) {
            document.getElementById('greeting').textContent = `Hi ${username}!`;
        } else {
            document.getElementById('greeting').textContent = "Hi there!";
        }
        
        if (cuppyName) {
            document.querySelector('.dialog-box p').textContent = `æˆ‘æ˜¯${cuppyName} å¾ˆé«˜èˆˆèªè­˜å°¼!!ğŸ˜€`;
        } else {
            console.error("æ‰¾ä¸åˆ°å°æ‡‰çš„ Cuppy åç¨±");
        }
        
        console.log("cupId:", cupId);
        fetchCuppyName(cupId);

        async function fetchCuppyName(cupId) {
            const response = await fetch(`${apiUrl}?type=cuppyNames`); 
            const cuppyNames = await response.json();
            console.log("cuppyNames:", cuppyNames);
            const cuppy = cuppyNames.find(c => String(c.cupId) === cupId);
            console.log("cuppy:", cuppy);
            if (cuppy) {
                document.querySelector('.dialog-box p').textContent = `æˆ‘æ˜¯${cuppy.cuppyName} å¾ˆé«˜èˆˆèªè­˜å°¼!!ğŸ˜€`;
            } else {
                console.error("æ‰¾ä¸åˆ°å°æ‡‰çš„ Cuppy åç¨±");
            }
        }
    </script>
    
</body>

</html>